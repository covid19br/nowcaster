<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Nowcasting on Structured data • nowcaster</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Nowcasting on Structured data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nowcaster</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/nowcaster.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/1_structured_data.html">Nowcasting on Structured data</a></li>
    <li><a class="dropdown-item" href="../articles/2_nowcasting_importance.html">Nowcasting for decision making</a></li>
    <li><a class="dropdown-item" href="../articles/3_forecasting.html">Beyond Nowcasting, Forecasting</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/covid19br/nowcaster/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Nowcasting on Structured data</h1>
                        <h4 data-toc-skip class="author">Rafael Lopes
&amp; Leonardo Bastos</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/covid19br/nowcaster/blob/HEAD/vignettes/articles/1_structured_data.Rmd" class="external-link"><code>vignettes/articles/1_structured_data.Rmd</code></a></small>
      <div class="d-none name"><code>1_structured_data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="tldr">TL;DR<a class="anchor" aria-label="anchor" href="#tldr"></a>
</h2>
<p>This is a longer article explaining the workings and the choices
behind the nowcasting model and its advantages and limitations.</p>
</div>
<div class="section level2">
<h2 id="as-before">As Before…<a class="anchor" aria-label="anchor" href="#as-before"></a>
</h2>
<p>As in the <a href="https://covid19br.github.io/nowcaster/articles/nowcaster.html">Get
Started</a> we start by loading the package and its lazy data, by:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://covid19br.github.io/nowcaster">nowcaster</a></span><span class="op">)</span></span>
<span><span class="co"># Loading Belo Horizonte SARI data set</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sragBH</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="non-structured-data">Non-structured data<a class="anchor" aria-label="anchor" href="#non-structured-data"></a>
</h2>
<p>The <a href="https://covid19br.github.io/nowcaster/articles/nowcaster.html">Get
Started</a> example is done on non-structured data, here we give a more
a detailed description of this type of data and how it can change the
nowcasting.</p>
<p>When we call the <code><a href="../reference/nowcasting_inla.html">nowcasting_inla()</a></code> function, 
it has by default, the parameterization takes the data and estimates with a
non-structured data form. The estimate fits a negative binomial
distribution,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>e</mi><mi>g</mi><mi>B</mi><mi>i</mi><mi>n</mi><mi>o</mi><mi>m</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>λ</mi><mrow><mi>t</mi><mo>,</mo><mi>d</mi></mrow></msub><mo>,</mo><mi>ϕ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">NegBinom(\lambda_{t,d}, \phi)</annotation></semantics></math>,
to the case count at a time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
with delay
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϕ</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
is the dispersion parameter. The rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mrow><mi>t</mi><mo>,</mo><mi>d</mi></mrow></msub><annotation encoding="application/x-tex">\lambda_{t,d}</annotation></semantics></math>
is then parametric in a log-linear format with a constant term added by
structured delay, random effects, and structured time random effects. This
is the whole premise of nowcasting, we model the case counts at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
Given the case count at that time and past values, as well as given the
delay the distribution of that count.</p>
<p>Hence, the model is given by the following:</p>
<p><span class="math display">$$\begin{equation}
Y_{t,d} \sim NegBinom(\lambda_{t,d}, \phi), \\
\log(\lambda_{t,d}) = \alpha + \beta_t + \gamma_d, \\
\beta_t := u_t - u_{(t-1)} - u_{(t-2)} \sim N(0,\tau_{\beta}); \gamma_d
:= u_d - u_{(d-1)} \sim N(0, \tau_{\gamma})\\
t=1,2,\ldots,T, \\ d=1,2,\ldots,D,
\end{equation}$$</span></p>
<p>Where the intercept
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
follows a Gaussian distribution with a very large variance,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\beta_t</annotation></semantics></math>
follows a second-order random walk with precision
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mi>β</mi></msub><annotation encoding="application/x-tex">\tau_\beta</annotation></semantics></math>,
while
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>γ</mi><mi>d</mi></msub><annotation encoding="application/x-tex">\gamma_d</annotation></semantics></math>
a first-order random walk with precision
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mi>γ</mi></msub><annotation encoding="application/x-tex">\tau_\gamma</annotation></semantics></math>.
The model is then completed by INLA's default prior distributions for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϕ</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mi>β</mi></msub><annotation encoding="application/x-tex">\tau_\beta</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mi>γ</mi></msub><annotation encoding="application/x-tex">\tau_\gamma</annotation></semantics></math>.
See <a href="https://inla.r-inla-download.org/r-inla.org/doc/likelihood/likelihood-example.pdf" class="external-link"><code>nbinomial</code></a>,
<a href="https://inla.r-inla-download.org/r-inla.org/doc/latent/rw1.pdf" class="external-link"><code>rw1</code></a>
and <a href="https://inla.r-inla-download.org/r-inla.org/doc/latent/rw1.pdf" class="external-link"><code>rw2</code></a>
INLA help pages.</p>
<p>The call of the function is straightforward; it simply needs data
set as input, here the <code>LazyData</code> loaded in the package namespace. 
The function has 3 mandatory parameters,
<code>dataset</code> to parse the data set to be nowcasted,
<code>date_onset</code> for parsing the column name, which is the date of
onset of symptoms and <code>date_report</code> which parses the column
name for the date of the report of the cases. Here, these columns are
“DT_SIN_PRI” and “DT_DIGITA”, respectively. The need for two dates is due to
we are modeling the delay as part of the nowcasting estimation, usually
nowcasting models, assuming a delay distribution and applying it to the
cases observed.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nowcasting_bh_no_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nowcasting_inla.html">nowcasting_inla</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">sragBH</span>, </span>
<span>                                        date_onset <span class="op">=</span> <span class="va">DT_SIN_PRI</span>, </span>
<span>                                        date_report <span class="op">=</span> <span class="va">DT_DIGITA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nowcasting_bh_no_age</span><span class="op">$</span><span class="va">total</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;    Time dt_event   Median    LI    LS   LIb   LSb</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    17 2021-12-13    444  442    448   443  445 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>    18 2021-12-20    632  626    641   630  634 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>    19 2021-12-27    736  727    749   733  740 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>    20 2022-01-03    759  746.   779   754  765.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>    21 2022-01-10    879  861    903   872  887 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>    22 2022-01-17    786  765    816   778  795</span></span></code></pre></div>
<p>The above calling will return only the nowcasting estimate and its
Confidence Interval (CI) for two different credibility levels,
<code>LIb</code> and <code>LSb</code> are the max and min CI,
respectively, with credibility of 50% and <code>LI</code> and
<code>LS</code> are the max and min CI, respectively, with credibility
of 95%.</p>
<p>The <code>nowcasting_inla</code> has the option to return the curve
on which the window of action of the model was set, if the
<code>data.by.week</code> parameter is flagged as <code>TRUE</code> it
returns on the second element of the output list, the summarized data by
week.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nowcasting_bh_no_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nowcasting_inla.html">nowcasting_inla</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">sragBH</span>, </span>
<span>                                        date_onset <span class="op">=</span> <span class="va">DT_SIN_PRI</span>, </span>
<span>                                        date_report <span class="op">=</span> <span class="va">DT_DIGITA</span>, </span>
<span>                                        data.by.week <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nowcasting_bh_no_age</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   dt_event   delay     Y  Time</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2021-08-23     0     8     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2021-08-23     1    70     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2021-08-23     2    92     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2021-08-23     3    68     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2021-08-23     4    32     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2021-08-23     5    32     1</span></span></code></pre></div>
<p>This element is the count of cases by each delay day. It is known
as the delay triangle, if we tabulate the delay amount against the date of
onset of the first symptoms, we can see the pattern of the delay for the
cases.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_triangle</span> <span class="op">&lt;-</span> <span class="va">nowcasting_bh_no_age</span><span class="op">$</span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">delay</span> <span class="op">&lt;</span> <span class="fl">30</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Time</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_triangle</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dt_event</span> <span class="op">&gt;=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dt_event</span><span class="op">)</span> <span class="op">-</span> <span class="fl">84</span><span class="op">)</span>,</span>
<span>         <span class="va">delay</span> <span class="op">&lt;=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html" class="external-link">spread</a></span><span class="op">(</span>key <span class="op">=</span> <span class="va">delay</span>, value <span class="op">=</span> <span class="va">Y</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 13 × 12</span></span></span>
<span><span class="co">#&gt;    dt_event     `0`   `1`   `2`   `3`   `4`   `5`   `6`   `7`   `8`   `9`  `10`</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2021-12-27     5   102   129    80    68   103    92    38    34    26    16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2022-01-03    14    94   101   108    91   113    74    63    28    15    21</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2022-01-10     0    98   151   102   140   116    89    68    32    26    19</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2022-01-17     4   128   106   131    98    90    78    51    21    29    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2022-01-24     9    88   121    81    63    71    28    37    30    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2022-01-31     6    76    90    80    77    38    33    39    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2022-02-07    12    71    77    60    33    36    36    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2022-02-14     5    77    60    48    69    45    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2022-02-21    16    52    81    39    29    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2022-02-28     7    57    52    39    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 2022-03-07     5    57    75    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 2022-03-14     6    57    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> 2022-03-21     3    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span>    <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>When we look at the number of cases with than 10 weeks of delay or
less than 84 days before the latest date. The default maximum is 30 weeks
delay is considered in nowcasting estimation.</p>
<p>If this element is groped and summarized by the onset of symptoms
date, here <code>DT_SIN_PRI</code>, it is the epidemiological curve
observed. To exemplify it, we plot the estimate and the epidemiological
curve altogether.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_by_week</span> <span class="op">&lt;-</span> <span class="va">nowcasting_bh_no_age</span><span class="op">$</span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">dt_event</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html" class="external-link">reframe</a></span><span class="op">(</span></span>
<span>    observed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Y</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dt_event</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dt_event</span><span class="op">)</span><span class="op">-</span><span class="fl">270</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nowcasting_bh_no_age</span><span class="op">$</span><span class="va">total</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dt_event</span> <span class="op">&gt;=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dt_event</span><span class="op">)</span><span class="op">-</span><span class="fl">270</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dt_event</span>, y <span class="op">=</span> <span class="va">Median</span>, col <span class="op">=</span> <span class="st">'Nowcasting'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_by_week</span>, </span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dt_event</span>, y <span class="op">=</span> <span class="va">observed</span>, col <span class="op">=</span> <span class="st">'Observed'</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">LI</span>, ymax <span class="op">=</span> <span class="va">LS</span>, col <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'grey50'</span>, <span class="st">'black'</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">''</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">'2 weeks'</span>, date_labels <span class="op">=</span> <span class="st">'%V/%y'</span>, name <span class="op">=</span> <span class="st">'Date in Weeks'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">''</span>, y <span class="op">=</span> <span class="st">'Nº Cases'</span><span class="op">)</span></span></code></pre></div>
<p><img src="1_structured_data_files/figure-html/no_age_plot-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="structured-data-age">Structured data, Age<a class="anchor" aria-label="anchor" href="#structured-data-age"></a>
</h2>
<p>The first improvement we have done on the baseline model for
nowcasting with non-structured data is to have the same model for
categorical class of the case counts, due to the epidemiological course
of SARS-CoV-2, we expect different ages to have different delays
distribution. We call this kind of looking into the data as the
structured data, as the data now has identifiers for time, delay, and
the age class of the cases. To the structured data we fit again a
Negative binomial distribution for the case count at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
with delay
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>.
Differently from the non-structured case, the model now gives random
effects on the delay distribution and time distribution by each of the
age-class chosen by the user to break the data. The model has the form
now:</p>
<p><span class="math display">$$\begin{equation}Y_{t,d,a}
\sim  NegBinom(\lambda_{t,d,a}, \phi), \\
\log(\lambda_{t,d,a}) =  \alpha_a + \beta_{t,a} + \gamma_{d,a}, \\
\beta_{t,a} := u_t - u_{(t-1)} - u_{(t-2)} \sim N(0,\tau_{a, \beta});
\gamma_{d,a} := u_d - u_{(d-1)} \sim N(0, \tau_{a, \gamma}) \\
t=1,2,\ldots,T, \\ d=1,2,\ldots,D, \\ a=1,2,\ldots,A,
\end{equation}$$</span></p>
<p>where each age class,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>a</mi><annotation encoding="application/x-tex">a</annotation></semantics></math>,
has an intercept
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mi>a</mi></msub><annotation encoding="application/x-tex">\alpha_a</annotation></semantics></math>
following a Gaussian distribution with a very large variance, the
time-age random effects,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>β</mi><mrow><mi>t</mi><mo>,</mo><mi>a</mi></mrow></msub><annotation encoding="application/x-tex">\beta_{t,a}</annotation></semantics></math>,
follow a joint multivariate Gaussian distribution with a separable
variance components, an independent Gaussian term for the age classes
with precision
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mrow><mi>a</mi><mo>,</mo><mi>β</mi></mrow></msub><annotation encoding="application/x-tex">\tau_{a,\beta}</annotation></semantics></math>
and a second-order random walk term for the time with precision
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mi>β</mi></msub><annotation encoding="application/x-tex">\tau_{\beta}</annotation></semantics></math>.
Analogously, the delay-age random effects,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>γ</mi><mrow><mi>d</mi><mo>,</mo><mi>a</mi></mrow></msub><annotation encoding="application/x-tex">\gamma_{d,a}</annotation></semantics></math>,
follow a joint multivariate Gaussian distribution with a separable
variance components, an independent Gaussian term for the age classes
with precision
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mrow><mi>a</mi><mo>,</mo><mi>γ</mi></mrow></msub><annotation encoding="application/x-tex">\tau_{a,\gamma}</annotation></semantics></math>
and a first-order random walk term for the time with precision
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mi>γ</mi></msub><annotation encoding="application/x-tex">\tau_{\gamma}</annotation></semantics></math>.
The model is then completed by INLA's default prior distributions for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϕ</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mrow><mi>a</mi><mo>,</mo><mi>β</mi></mrow></msub><annotation encoding="application/x-tex">\tau_{a,\beta}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mrow><mi>a</mi><mo>,</mo><mi>γ</mi></mrow></msub><annotation encoding="application/x-tex">\tau_{a,\gamma}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mrow><mi>a</mi><mo>,</mo><mi>β</mi></mrow></msub><annotation encoding="application/x-tex">\tau_{a,\beta}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>τ</mi><mi>γ</mi></msub><annotation encoding="application/x-tex">\tau_\gamma</annotation></semantics></math>.
See <a href="https://inla.r-inla-download.org/r-inla.org/doc/likelihood/likelihood-example.pdf" class="external-link"><code>nbinomial</code></a>,
<a href="https://inla.r-inla-download.org/r-inla.org/doc/latent/rw1.pdf" class="external-link"><code>rw1</code></a>
and <a href="https://inla.r-inla-download.org/r-inla.org/doc/latent/rw1.pdf" class="external-link"><code>rw2</code></a>
INLA help pages.</p>
<p>This new model corrects the delay, taking into account the effects of
age classes and the interactions of each age class between time and 
delay. Now the model needs a flag indicating which column in the
data set will be used to break the data into age classes, and
another parameter flagging on how the age classes will be split. This is
given by the parameters <code>age_col</code> and <code>bins_age</code>.
We also pass two additional parameters, <code>data.by.week</code> to
return the epidemiological curve out of a window of action of nowcasting
estimate and <code>return.age</code> to inform we desire a nowcasting
result in two ways, the total aggregation estimate and the
age-stratified estimate. The calling of the function has the following
form:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nowcasting_bh_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nowcasting_inla.html">nowcasting_inla</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">sragBH</span>, </span>
<span>                                     bins_age <span class="op">=</span> <span class="st">"10 years"</span>,</span>
<span>                                     data.by.week <span class="op">=</span> <span class="cn">T</span>, </span>
<span>                                     date_onset <span class="op">=</span> <span class="va">DT_SIN_PRI</span>, </span>
<span>                                     date_report <span class="op">=</span> <span class="va">DT_DIGITA</span>,</span>
<span>                                     age_col <span class="op">=</span> <span class="va">Idade</span><span class="op">)</span></span></code></pre></div>
<p>Each of the estimates returned by <code>nowcasting_inla</code> has
the same form as in the non-structured case. On the nowcasting
estimates, it returns a <code>data.frame</code> with the posterior
median and 50% and 95% credible intervals, (LIb and LSb) and (LI and LS)
respectively.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dados_by_week</span> <span class="op">&lt;-</span> <span class="va">nowcasting_bh_age</span><span class="op">$</span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">dt_event</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html" class="external-link">reframe</a></span><span class="op">(</span></span>
<span>    observed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Y</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dt_event</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dt_event</span><span class="op">)</span><span class="op">-</span><span class="fl">270</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">nowcasting_bh_age</span><span class="op">$</span><span class="va">total</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dt_event</span>, y <span class="op">=</span> <span class="va">Median</span>, </span>
<span>                col <span class="op">=</span> <span class="st">'Nowcasting'</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dados_by_week</span>, </span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dt_event</span>, y <span class="op">=</span> <span class="va">observed</span>, </span>
<span>                col <span class="op">=</span> <span class="st">"Observed"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dt_event</span>, y <span class="op">=</span> <span class="va">Median</span>,</span>
<span>                  ymin <span class="op">=</span> <span class="va">LI</span>, ymax <span class="op">=</span> <span class="va">LS</span><span class="op">)</span>, </span>
<span>              alpha <span class="op">=</span> <span class="fl">0.2</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'grey50'</span>, <span class="st">'black'</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">''</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">'2 weeks'</span>, date_labels <span class="op">=</span> <span class="st">'%V/%y'</span>, name <span class="op">=</span> <span class="st">'Date in Weeks'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">''</span>, y <span class="op">=</span> <span class="st">'Nº Cases'</span><span class="op">)</span></span></code></pre></div>
<p><img src="1_structured_data_files/figure-html/plot-1.png" width="700"></p>
<p>For the sake of completeness, we plot both estimates together to check how
different they are.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dados_by_week</span>, </span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dt_event</span>, y <span class="op">=</span> <span class="va">observed</span>, </span>
<span>                color <span class="op">=</span> <span class="st">"Observed"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nowcasting_bh_no_age</span><span class="op">$</span><span class="va">total</span> <span class="op">|&gt;</span> </span>
<span>              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dt_event</span> <span class="op">&gt;=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dt_event</span><span class="op">)</span><span class="op">-</span><span class="fl">270</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dt_event</span>, y <span class="op">=</span> <span class="va">Median</span>, </span>
<span>                color <span class="op">=</span> <span class="st">'Nowcasting - Non-structured'</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nowcasting_bh_no_age</span><span class="op">$</span><span class="va">total</span> <span class="op">|&gt;</span> </span>
<span>              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dt_event</span> <span class="op">&gt;=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dt_event</span><span class="op">)</span><span class="op">-</span><span class="fl">270</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dt_event</span>, y <span class="op">=</span> <span class="va">Median</span>,</span>
<span>                  ymin <span class="op">=</span> <span class="va">LI</span>, ymax <span class="op">=</span> <span class="va">LS</span>,</span>
<span>                  fill <span class="op">=</span> <span class="st">"Nowcasting - Non-structured"</span><span class="op">)</span>, </span>
<span>              alpha <span class="op">=</span> <span class="fl">0.5</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nowcasting_bh_age</span><span class="op">$</span><span class="va">total</span> <span class="op">|&gt;</span> </span>
<span>              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dt_event</span> <span class="op">&gt;=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dt_event</span><span class="op">)</span><span class="op">-</span><span class="fl">270</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dt_event</span>, y <span class="op">=</span> <span class="va">Median</span>, </span>
<span>                color <span class="op">=</span> <span class="st">'Nowcasting - Structured'</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nowcasting_bh_age</span><span class="op">$</span><span class="va">total</span> <span class="op">|&gt;</span> </span>
<span>              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dt_event</span> <span class="op">&gt;=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dt_event</span><span class="op">)</span><span class="op">-</span><span class="fl">270</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dt_event</span>, y <span class="op">=</span> <span class="va">Median</span>,</span>
<span>                  ymin <span class="op">=</span> <span class="va">LI</span>, ymax <span class="op">=</span> <span class="va">LS</span>,</span>
<span>                  fill <span class="op">=</span> <span class="st">"Nowcasting - Structured"</span><span class="op">)</span>, </span>
<span>              alpha <span class="op">=</span> <span class="fl">0.5</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, </span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lightblue4"</span>, </span>
<span>                                <span class="st">"orange4"</span>, </span>
<span>                                <span class="st">"black"</span><span class="op">)</span>,</span>
<span>                     name <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lightblue1"</span>, </span>
<span>                                <span class="st">"orange1"</span>, </span>
<span>                                <span class="st">"black"</span><span class="op">)</span>,</span>
<span>                    name <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">'2 weeks'</span>, </span>
<span>               date_labels <span class="op">=</span> <span class="st">'%V/%y'</span>, </span>
<span>               name <span class="op">=</span> <span class="st">'Date in Weeks'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">''</span>, </span>
<span>       y <span class="op">=</span> <span class="st">'Nº Cases'</span><span class="op">)</span></span></code></pre></div>
<p><img src="1_structured_data_files/figure-html/comparison-1.png" width="700"></p>
<p>The nowcasting when using the age information is narrower and shows a
less decreasing tendency at the end of the time series. This is due to
as each age classes have a nowcasting model acting on it, it can capture
effects once mascaraed when not breaking by age.</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Over this vignette, we learned how to use the
<code><a href="../reference/nowcasting_inla.html">nowcasting_inla()</a></code> and how <code>nowcaster</code> can employ
two different models, one without considering the differences of delay by
age class, and another considering the differences in delay per age class.
Finally, we compared both estimates, showing that the model that uses
the age class information to nowcasting produces narrower estimates</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Casted by <a href="https://github.com/rafalopespx" class="external-link">Rafael Lopes</a>, <a href="https://github.com/lsbastos/" class="external-link">Leonardo Bastos</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
