<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="nowcaster">
<title>Forecasting • nowcaster</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Forecasting">
<meta property="og:description" content="nowcaster">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nowcaster</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/nowcaster.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/1_structured_data.html">Structured data</a>
    <a class="dropdown-item" href="../articles/2_nowcasting_importance.html">Nowcasting for decision making</a>
    <a class="dropdown-item" href="../articles/3_forecasting.html">Forecasting</a>
    <a class="dropdown-item" href="../articles/forecasting.html">Forecasting</a>
    <a class="dropdown-item" href="../articles/nowcasting_importance.html">Nowcasting for decision making</a>
    <a class="dropdown-item" href="../articles/structured_data.html">Structured data</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/covid19br/nowcaster/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Forecasting</h1>
                        <h4 data-toc-skip class="author">Rafael Lopes
&amp; Leonardo Bastos</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/covid19br/nowcaster/blob/HEAD/vignettes/articles/3_forecasting.Rmd" class="external-link"><code>vignettes/articles/3_forecasting.Rmd</code></a></small>
      <div class="d-none name"><code>3_forecasting.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="forecasting">Forecasting<a class="anchor" aria-label="anchor" href="#forecasting"></a>
</h2>
<p>Nowcasting is the estimation of the events that are already started
but not yet reported. In epidemiology, the events as like cases of an
infectious disease that has onset its first symptoms but are not yet
captured from the notification system. Forecasting is simply the
estimation of the events that are not yet started its onset of first
symptoms, i.e. cases that are in a probable incubation period. From the
data structure that any databases has is basically the cases that has a
date of onset greater than present date. In the language of delay
triangle, forecasting will be only to estimate the part that is
completely unobserved.</p>
</div>
<div class="section level2">
<h2 id="parameter-k-0">Parameter K &gt; 0<a class="anchor" aria-label="anchor" href="#parameter-k-0"></a>
</h2>
<p>The <code>nowcasting_inla</code> function has a functional parameter
that flags to the model parsed to <code>inla</code> to construct the
delay triangle with dates greater than the present date. This is done by
the setting the <code>K</code> parameter to a value greater than 0, like
<span class="math inline">\(K = 1,2,3,\dots\)</span>. We proceed as in
any other example of nowcasting. We will forecasting as was done for
nowcasting in the article <a href="https://covid19br.github.io/nowcaster/articles/nowcasting_importance.html">Nowcasting
for decision making</a>.</p>
<p>First, we cut the lazydata loaded with the namespace of the package
to a date of interest, more details on why we cut on this date see the
article <a href="https://covid19br.github.io/nowcaster/articles/nowcasting_importance.html">Nowcasting
for decision making</a>. And after this we parse to the
<code>nowcasting_inla</code> function the date of onset and date of
report columns, a flag for returning a data.frame with the cases counts
by week and setting the <code>K</code> parameter to a desired
forecasting horizon, here we forecast one week ahead of the present
date.</p>
<p>Before forecasting, we construct the case counts curve from the
lazydata, by using the internal function <code>data.w_no_age</code>, we
construct the curve by summarizing the case counts by each date of onset
of first symptoms present at the database.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://covid19br.github.io/nowcaster">nowcaster</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## To see Nowcasting as if we were on the verge of rise in the curve</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"sragBH"</span><span class="op">)</span></span>
<span><span class="va">srag_now</span> <span class="op">&lt;-</span> <span class="va">sragBH</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">DT_DIGITA</span> <span class="op">&lt;=</span> <span class="st">"2020-07-04"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_by_week</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data.w_no_age.html">data.w_no_age</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">srag_now</span>, </span>
<span>                             date_onset <span class="op">=</span> <span class="va">DT_SIN_PRI</span>, </span>
<span>                             date_report <span class="op">=</span> <span class="va">DT_DIGITA</span>, </span>
<span>                             K <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">date_onset</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">tally</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_by_week</span> <span class="op">|&gt;</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date_onset</span>, </span>
<span>             y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Date of onset of symptons'</span>, </span>
<span>       y <span class="op">=</span> <span class="st">'Nº Cases'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'grey50'</span>, <span class="st">'black'</span><span class="op">)</span>, </span>
<span>                     name <span class="op">=</span> <span class="st">''</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">'2 weeks'</span>, </span>
<span>               date_labels <span class="op">=</span> <span class="st">'%V/%y'</span>, </span>
<span>               name <span class="op">=</span> <span class="st">'Date in Weeks'</span><span class="op">)</span></span></code></pre></div>
<p><img src="3_forecasting_files/figure-html/delay%20triangle-1.png" width="700"></p>
<p>Now, to forecast one week ahead we just flag the <code>K = 1</code>,
and proceed as in normal nowcasting calling, the code is:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nowcasting_bh_no_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nowcasting_inla.html">nowcasting_inla</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">srag_now</span>, </span>
<span>                                        date_onset <span class="op">=</span> <span class="va">DT_SIN_PRI</span>, </span>
<span>                                        date_report <span class="op">=</span> <span class="va">DT_DIGITA</span>, </span>
<span>                                        data.by.week <span class="op">=</span> <span class="cn">T</span>, </span>
<span>                                        K <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nowcasting_bh_no_age</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   dt_event   delay     Y  Time</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2019-12-28     0     1     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2019-12-28     1     2     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2019-12-28     2     4     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2019-12-28     3     5     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2019-12-28     4     2     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2019-12-28     5     2     1</span></span></code></pre></div>
<p>To visualize the forecast we plot the observed curve and the
nowcasting and forecasting estimate, change the colors for each part. We
plot together the nowcasting and forecasting estimate, the curve
observed one year later, to validate the estimate done.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Nowcasting estimate filtering</span></span>
<span><span class="va">nowcasting_estimate</span><span class="op">&lt;-</span><span class="va">nowcasting_bh_no_age</span><span class="op">$</span><span class="va">total</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dt_event</span> <span class="op">&lt;=</span> <span class="st">"2020-06-27"</span><span class="op">)</span></span>
<span><span class="co">## Forecasting estimate filtering</span></span>
<span><span class="va">forecasting_estimate</span><span class="op">&lt;-</span><span class="va">nowcasting_bh_no_age</span><span class="op">$</span><span class="va">total</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dt_event</span> <span class="op">&gt;=</span> <span class="st">"2020-06-27"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## One year after observed</span></span>
<span><span class="va">data_one_year_after</span><span class="op">&lt;-</span><span class="va">sragBH</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">DT_SIN_PRI</span> <span class="op">&lt;=</span> <span class="st">"2020-07-11"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    D_SIN_PRI_2 <span class="op">=</span> <span class="va">DT_SIN_PRI</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">DT_SIN_PRI</span>, <span class="st">"%w"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">D_SIN_PRI_2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">tally</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## Plotting</span></span>
<span><span class="va">nowcasting_estimate</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dt_event</span>, y <span class="op">=</span> <span class="va">Median</span>, col <span class="op">=</span> <span class="st">"Nowcasting"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">LI</span>, ymax <span class="op">=</span> <span class="va">LS</span>, col <span class="op">=</span> <span class="st">"Nowcasting"</span>, fill <span class="op">=</span> <span class="st">"Nowcasting"</span><span class="op">)</span>, </span>
<span>              alpha <span class="op">=</span> <span class="fl">0.2</span>, </span>
<span>              show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">forecasting_estimate</span>, </span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dt_event</span>, y <span class="op">=</span> <span class="va">Median</span>, col <span class="op">=</span> <span class="st">"Forecasting"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">forecasting_estimate</span>, </span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">LI</span>, ymax <span class="op">=</span> <span class="va">LS</span>, col <span class="op">=</span> <span class="st">"Forecasting"</span>, fill <span class="op">=</span> <span class="st">"Forecasting"</span><span class="op">)</span>, </span>
<span>              alpha <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>              show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_by_week</span>, </span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">date_onset</span>, y <span class="op">=</span> <span class="va">n</span>, col <span class="op">=</span> <span class="st">'Observed'</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_one_year_after</span>, </span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">D_SIN_PRI_2</span>, y <span class="op">=</span> <span class="va">n</span>, </span>
<span>                          color <span class="op">=</span> <span class="st">"Observed after one year"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, </span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'orange'</span>,<span class="st">'grey50'</span>, <span class="st">'black'</span>, <span class="st">'red'</span><span class="op">)</span>, </span>
<span>                     name <span class="op">=</span> <span class="st">''</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'orange'</span>,<span class="st">'grey50'</span><span class="op">)</span>, </span>
<span>                     name <span class="op">=</span> <span class="st">''</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">'2 weeks'</span>, </span>
<span>               date_labels <span class="op">=</span> <span class="st">'%V/%y'</span>, </span>
<span>               name <span class="op">=</span> <span class="st">'Date in Weeks'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">''</span>, </span>
<span>       y <span class="op">=</span> <span class="st">'Nº Cases'</span><span class="op">)</span></span></code></pre></div>
<p><img src="3_forecasting_files/figure-html/after_one_year-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="uncertainty-grows">Uncertainty grows<a class="anchor" aria-label="anchor" href="#uncertainty-grows"></a>
</h2>
<p>As we try to forecasting longer ahead of the present date, the
uncertainty has to grow. This is saw by the opening of the confidence
intervals on the last graph. Although it is wide the realized curve
still falls inside it, indicating that is assertative on the tendency of
the curve at least. This can be taken to support decision making when
planning ahead of the present date. To any other forecasting horizon
further than 1 week ahead, the confidence interval will be wider than
this, to help a little we can try a forecasting with an imposed
structured on the data. Now, we forecasting parsing the columns for age
to the nowcasting function, this can reduce the opening of the
confidence interval.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nowcasting_bh_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nowcasting_inla.html">nowcasting_inla</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">srag_now</span>, </span>
<span>                                     date_onset <span class="op">=</span> <span class="va">DT_SIN_PRI</span>, </span>
<span>                                     date_report <span class="op">=</span> <span class="va">DT_DIGITA</span>, </span>
<span>                                     data.by.week <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                                     K <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                     age_col <span class="op">=</span> <span class="va">Idade</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nowcasting_bh_age</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">#&gt;   dt_event   delay fx_etaria     Y  Time</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2019-12-28     0 1             0     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2019-12-28     0 2             0     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 2019-12-28     0 3             0     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 2019-12-28     0 4             0     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 2019-12-28     0 5             0     1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 2019-12-28     0 6             0     1</span></span></code></pre></div>
<p>And we plot the nowcasting estimate and forecasting estimate
again:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## Nowcasting estimate filtering</span></span>
<span><span class="va">nowcasting_estimate</span><span class="op">&lt;-</span><span class="va">nowcasting_bh_age</span><span class="op">$</span><span class="va">total</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dt_event</span> <span class="op">&lt;=</span> <span class="st">"2020-06-27"</span><span class="op">)</span></span>
<span><span class="co">## Forecasting estimate filtering</span></span>
<span><span class="va">forecasting_estimate</span><span class="op">&lt;-</span><span class="va">nowcasting_bh_age</span><span class="op">$</span><span class="va">total</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dt_event</span> <span class="op">&gt;=</span> <span class="st">"2020-06-27"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Plotting</span></span>
<span><span class="va">nowcasting_estimate</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dt_event</span>, y <span class="op">=</span> <span class="va">Median</span>, col <span class="op">=</span> <span class="st">"Nowcasting"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">LI</span>, ymax <span class="op">=</span> <span class="va">LS</span>, col <span class="op">=</span> <span class="st">"Nowcasting"</span>, fill <span class="op">=</span> <span class="st">"Nowcasting"</span><span class="op">)</span>, </span>
<span>              alpha <span class="op">=</span> <span class="fl">0.2</span>, </span>
<span>              show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">forecasting_estimate</span>, </span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dt_event</span>, y <span class="op">=</span> <span class="va">Median</span>, col <span class="op">=</span> <span class="st">"Forecasting"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">forecasting_estimate</span>, </span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">LI</span>, ymax <span class="op">=</span> <span class="va">LS</span>, col <span class="op">=</span> <span class="st">"Forecasting"</span>, fill <span class="op">=</span> <span class="st">"Forecasting"</span><span class="op">)</span>, </span>
<span>              alpha <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>              show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_by_week</span>, </span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">date_onset</span>, y <span class="op">=</span> <span class="va">n</span>, col <span class="op">=</span> <span class="st">'Observed'</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_one_year_after</span>, </span>
<span>            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">D_SIN_PRI_2</span>, y <span class="op">=</span> <span class="va">n</span>, </span>
<span>                          color <span class="op">=</span> <span class="st">"Observed after one year"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, </span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'orange'</span>,<span class="st">'grey50'</span>, <span class="st">'black'</span>, <span class="st">'red'</span><span class="op">)</span>, </span>
<span>                     name <span class="op">=</span> <span class="st">''</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'orange'</span>,<span class="st">'grey50'</span><span class="op">)</span>, </span>
<span>                     name <span class="op">=</span> <span class="st">''</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_breaks <span class="op">=</span> <span class="st">'2 weeks'</span>, </span>
<span>               date_labels <span class="op">=</span> <span class="st">'%V/%y'</span>, </span>
<span>               name <span class="op">=</span> <span class="st">'Date in Weeks'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">''</span>, </span>
<span>       y <span class="op">=</span> <span class="st">'Nº Cases'</span><span class="op">)</span></span></code></pre></div>
<p><img src="3_forecasting_files/figure-html/after_one_year_forecasting-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Casted by <a href="https://github.com/rafalopespx" class="external-link">Rafael Lopes</a>, <a href="https://github.com/lsbastos/" class="external-link">Leonardo Bastos</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
